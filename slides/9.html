<section>
  <h2>symfony/runtime</h2>
  <ul>
    <li>Allows to decouple bootstrapping logic from global state</li>
    <li>Simplifies bootstrapping when applications running in PHP runtimes</li>
  </ul>
  
  <!-- Speaker note starts -->
  <aside class="notes">
    https://symfony.com/doc/current/components/runtime.html
    <ul>
      <li>The brief introduction of the symfony/runtime</li>
      <li>Symfony/runtime decouples bootstrapping logic from global application state</li>
      <li>With that we can run the application in decoupled mode with php runtimes like React php, Swoole, PHP-PM etc.</li>
      <li>What's the purpose of symfony/runtime here?</li>
      <li>First, we will initialize an application from our binary and include the autoload_runtime.php</li>
      <li>This autoload_runtime.php will find the appropriate runner the application instance that we created in our dex command's binary file</li>
      <li>Now, let's straight away jump on the code of dex_console module.</li>
      <li>In the code, we will review how compiler-pass works, how we have build binary file.</li>
      <li>So, let's get started with the compiler pass implementation in dex_console module.</li>
    </ul>
  </aside>
  <!-- Speaker note ends -->
</section>

<section>
  <pre data-id="code-animation" >
    <code class="hljs php" data-trim data-line-numbers="7|13|18-21|22-27">
      // autoload_runtime.php @generated by Symfony Runtime
      
      if (true === (require_once __DIR__.'/autoload.php') || empty($_SERVER['SCRIPT_FILENAME'])) {
          return;
      }
      
      $app = require $_SERVER['SCRIPT_FILENAME'];
      
      if (!is_object($app)) {
          throw new TypeError(sprintf('Invalid return value: callable object expected, "%s" returned from "%s".', get_debug_type($app), $_SERVER['SCRIPT_FILENAME']));
      }
      
      $runtime = $_SERVER['APP_RUNTIME'] ?? $_ENV['APP_RUNTIME'] ?? 'Symfony\\Component\\Runtime\\SymfonyRuntime';
      $runtime = new $runtime(($_SERVER['APP_RUNTIME_OPTIONS'] ?? $_ENV['APP_RUNTIME_OPTIONS'] ?? []) + [
        'project_dir' => dirname(__DIR__, 1),
      ]);
      
      [$app, $args] = $runtime
          ->getResolver($app)
          ->resolve();
      
      $app = $app(...$args);
      
      exit(
          $runtime
              ->getRunner($app)
              ->run()
      );
    </code>
  </pre>
  <h6> Code of autoload_runtime.php</h6>
  
  <!-- Speaker note starts -->
  <aside class="notes">
    https://symfony.com/doc/current/components/runtime.html
    <ul>
      <li>Let's see how it looks like in <b>autoload_runtime.php</b>
        <ul>
          <li>First we will include our script.</li>
          <li>Later in line 13 we are initializing the SymfonyRuntime</li>
          <li>Line 18-21 will find the resolver and will call the resolve method</li>
          <li>Later we initialize the application with te arguments.</li>
          <li>On line 22-27, we will get the runner for the application and eventually runtime will run the application.</li>
        </ul>
      </li>
    </ul>
  </aside>
  <!-- Speaker note ends -->

</section>
