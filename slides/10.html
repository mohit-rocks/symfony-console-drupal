<h2>symfony/runtime sample application</h2>
<section>
  <pre data-id="code-animation">
    <code class="hljs php" data-trim data-line-numbers>
      #!/usr/bin/env php

      require_once dirname($GLOBALS['_composer_autoload_path']) . '/autoload_runtime.php';
      
      return static function () {
      
      };
    </code>
  </pre>
  <h6> Code of application file</h6>
  
  <!-- Speaker note starts -->
  <aside class="notes">
    <ul>
      <li>Symfony/runtime decouples bootstrapping logic from global state</li>
      <li>In our example, we are simply creating an application/closure that just prints "Hello" world characters</li>
      <li>Now, we will first write the front controller. The job of front-controller is to create an application for us</li>
      <li>Typically, we will create an anonymous function and will return the application.</li>
    </ul>
  </aside>
</section>

<section>
  <pre data-id="code-animation"><code class="hljs php" data-trim data-line-numbers="6-15">
    #!/usr/bin/env php
    
    require_once dirname($GLOBALS['_composer_autoload_path']) . '/autoload_runtime.php';
    
    return static function (array $context) {
     $app = function () use ($context) {
       $url = $context['REQUEST_URI'];
       if ($url === '/hello') {
         echo 'Hello';
       }
       if ($url === '/hello/world') {
         echo 'Hello World';
       }
     };
     return $app;
    };
  </code></pre>
  <h6> Code of application file</h6>
  
  <!-- Speaker note starts -->
  <aside class="notes">
    <ul>
      <li>Now, we have our front-controller. The job of front-controller is to create an application for us</li>
      <li>Now we are writing an application using closure and return the application instead of executing it.</li>
      <li>Symfony Callable is called to get the service application</li>
      <li>SymfonyRuntime will use this application and find the appropriate runner</li>
      <li>Now, let's see how symfony/runtime will initialize and run teh application</li>
    </ul>
  </aside>
</section>

<section>
  <pre data-id="code-animation" >
    <code class="hljs php" data-trim data-line-numbers="7|13|18-21|22-27">
      // autoload_runtime.php @generated by Symfony Runtime
      
      if (true === (require_once __DIR__.'/autoload.php') || empty($_SERVER['SCRIPT_FILENAME'])) {
          return;
      }
      
      $app = require $_SERVER['SCRIPT_FILENAME'];
      
      if (!is_object($app)) {
          throw new TypeError(sprintf('Invalid return value: callable object expected, "%s" returned from "%s".', get_debug_type($app), $_SERVER['SCRIPT_FILENAME']));
      }
      
      $runtime = $_SERVER['APP_RUNTIME'] ?? $_ENV['APP_RUNTIME'] ?? 'Symfony\\Component\\Runtime\\SymfonyRuntime';
      $runtime = new $runtime(($_SERVER['APP_RUNTIME_OPTIONS'] ?? $_ENV['APP_RUNTIME_OPTIONS'] ?? []) + [
        'project_dir' => dirname(__DIR__, 1),
      ]);
      
      [$app, $args] = $runtime
          ->getResolver($app)
          ->resolve();
      
      $app = $app(...$args);
      
      exit(
          $runtime
              ->getRunner($app)
              ->run()
      );
    </code>
  </pre>
  <h6> Code of autoload_runtime.php</h6>
  
  <!-- Speaker note starts -->
  <aside class="notes">
    https://symfony.com/doc/current/components/runtime.html
    <ul>
      <li>Let's see how it looks like in <b>autoload_runtime.php</b>
        <ul>
          <li>First we will include our script.</li>
          <li>Later in line 13 we are initializing the SymfonyRuntime</li>
          <li>Line 18-21 will find the resolver and will call the resolve method</li>
          <li>Since it is a closure, SymfonyRuntime will call <em>ClosureResolver</em>, resolve() method of resolver will run the application.</li>
          <li>On line 22-27, we will get the runner for the application and eventually runtime will run the application.</li>
          <li>In our case, it will call <em>ClosureRunner</em> instance to run application</li>
        </ul>
      </li>
    </ul>
  </aside>
  <!-- Speaker note ends -->
  
</section>
